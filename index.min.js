const isObjectLiteral=(e=null)=>null!==e&&"[object Object]"===Object.prototype.toString.call(e)&&Object.getPrototypeOf(e)===Object.prototype,HTML_TAGS=["base","head","link","meta","style","title","body","address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","search","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","menu","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rp","rt","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","area","audio","img","map","track","video","embed","iframe","object","picture","portal","source","svg","math","canvas","noscript","script","del","ins","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr","button","datalist","fieldset","form","input","label","legend","meter","optgroup","option","output","progress","select","textarea","details","dialog","summary","slot","template","acronym","big","center","content","dir","font","frame","frameset","image","marquee","menuitem","nobr","noembed","noframes","param","plaintext","rb","rtc","shadow","strike","tt","xmp"];function generateElementConstructor(e){return function(...t){const s=document.createElement(e);for(let e of t)if(isObjectLiteral(e))for(let t in e)if(isObjectLiteral(e[t])){let u=[];for(let s in e[t])u.push(`${s}: ${e[t][s]};`);s.setAttribute(t,u.join(" "))}else t.startsWith("on")?s.addEventListener(t.slice(2),(s=>("function"==typeof e[t]?e[t](s):e[t],s.stopImmediatePropagation())),!1):s.setAttribute(t,e[t]);else e instanceof Element?s.appendChild(e):"function"==typeof e?.toString&&s.appendChild(document.createTextNode(e.toString()));return s}}const append=(e,...t)=>(t.forEach((t=>e.appendChild(t))),e),tags=Object.fromEntries(HTML_TAGS.map((e=>[e,generateElementConstructor(e)]))),customTag=e=>generateElementConstructor(e);let CurrentAccessed=null,CurrentBoundToRemove=[];class State{static create(e){return new State(e)}static _FlushedDisposeQueue=!1;static#e(){State._FlushedDisposeQueue=!0,DerivedState._FlushedDisposeQueue&&(CurrentBoundToRemove=[],DerivedState._FlushedDisposeQueue=!1,State._FlushedDisposeQueue=!1)}#t;#s;constructor(e=null){this.#t=e,this.#s=new Set}get value(){if(CurrentAccessed&&this._subscribe(CurrentAccessed),CurrentBoundToRemove.length>0){for(let e of CurrentBoundToRemove)this._unsubscribe(e);State.#e()}return this.#t}set value(e){if(CurrentBoundToRemove.length>0){for(let e of CurrentBoundToRemove)this._unsubscribe(e);State.#e()}this.#t!==e&&(this.#t=e,this.#u(),EffectState._runQueue())}peek(){return this.#t}#u(){for(let e of this.#s)e._update()}_subscribe(e){this.#s.add(e)}_unsubscribe(e){this.#s.delete(e)}}class DerivedState{static create(e){return new DerivedState(e)}static _FlushedDisposeQueue=!1;static#e(){DerivedState._FlushedDisposeQueue=!0,State._FlushedDisposeQueue&&(CurrentBoundToRemove=[],DerivedState._FlushedDisposeQueue=!1,State._FlushedDisposeQueue=!1)}#r;#t;#i;#s;constructor(e){this.#r=e,this.#t=void 0,this.#i=!0,this.#s=new Set}get value(){if(this.#i){const e=CurrentAccessed;CurrentAccessed=this,this.#n(),CurrentAccessed=e}if(CurrentAccessed&&this._subscribe(CurrentAccessed),CurrentBoundToRemove.length>0){for(let e of CurrentBoundToRemove)this._unsubscribe(e);DerivedState.#e()}return this.#t}#n(){this.#t=this.#r(),this.#i=!1}peek(){return this.#t}_subscribe(e){this.#s.add(e)}_unsubscribe(e){this.#s.delete(e)}_update(){if(!this.#i){this.#i=!0;for(let e of this.#s)e._update()}}dispose(){CurrentBoundToRemove.push(this);for(let e of this.#s)e.dispose&&e.dispose()}}class EffectState{static create(e){return new EffectState(e)}static#o=[];static _runQueue(){for(;EffectState.#o.length>0;)EffectState.#o.shift()._execute()}#a;#i;constructor(e){this.#a=e,this.#i=!0,this._execute()}_execute(){this.#i&&(CurrentAccessed=this,this.#a(),CurrentAccessed=null)}_update(){this.#i=!0,this._execute()}dispose(){CurrentBoundToRemove.push(this)}}const effect=e=>EffectState.create(e),state=e=>State.create(e),derive=e=>DerivedState.create(e);export{append,tags,customTag,effect,state,derive};
